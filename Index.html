<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Microserviço AWS - Cálculo Tributário</title>
</head>

<body
  style="font-family: Arial, sans-serif; background: #8397ac; display: flex; justify-content: center; align-items: center; height: 100vh;">
  <div
    style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.1); width: 380px;">

    <h2 style="text-align:center; color:#155786;">Cálculos Tributários</h2>

    <!-- Tipo de cálculo -->
    <p style="font-weight:bold; margin-top:10px;">Escolha o tipo de cálculo:</p>
    <div style="margin-top:5px; margin-bottom:15px;">
      <label><input type="radio" name="tipo" value="imposto" checked onchange="atualizarLabel()"> Calcular Valor do
        Imposto</label><br>
      <label><input type="radio" name="tipo" value="venda" onchange="atualizarLabel()"> Calcular Preço de Venda</label>
    </div>

    <!-- Campo valor -->
    <label id="labelValor" for="valor" style="font-weight:bold;">Valor Final do Produto:</label>
    <input type="number" id="valor" placeholder="Ex: 100"
      style="width:100%; padding:10px; margin-top:8px; border:1px solid #777474; border-radius:6px;">

    <!-- CAMPO DE LUCRO (NOVO) -->
    <div id="campoLucro" style="display:none; margin-top:10px;">
      <label style="font-weight:bold;">Percentual de lucro desejado (%)</label>
      <input id="lucro" type="number" placeholder="Ex: 30"
        style="width:100%; padding:10px; margin-top:5px; border:1px solid #777474; border-radius:6px;">
    </div>

    <!-- Regime tributário -->
    <p style="font-weight:bold; margin-top:15px;">Regime Tributário:</p>
    <div style="margin-top:8px; margin-bottom:10px;">
      <label><input type="radio" name="regime" value="simples" checked onchange="mostrarCampos()"> Simples
        Nacional</label><br>
      <label><input type="radio" name="regime" value="presumido" onchange="mostrarCampos()"> Lucro Presumido</label><br>
      <label><input type="radio" name="regime" value="real" onchange="mostrarCampos()"> Lucro Real</label>
    </div>

    <!-- Área dinâmica dos percentuais -->
    <div id="camposSimples" style="display:block;">
      <label style="font-weight:bold;">Percentual (%)</label>
      <input id="percSimples" type="number" placeholder="Ex: 6"
        style="width:100%; padding:10px; margin-top:5px; border:1px solid #777474; border-radius:6px;">
    </div>

    <div id="camposDetalhados" style="display:none; margin-top:10px;">
      <label style="font-weight:bold;">ICMS (%)</label>
      <input id="icms" type="number" placeholder="Ex: 12"
        style="width:100%; padding:10px; margin-top:5px; border:1px solid #777474; border-radius:6px;">

      <label style="font-weight:bold; margin-top:10px;">PIS (%)</label>
      <input id="pis" type="number" placeholder="Ex: 1.65"
        style="width:100%; padding:10px; margin-top:5px; border:1px solid #777474; border-radius:6px;">

      <label style="font-weight:bold; margin-top:10px;">COFINS (%)</label>
      <input id="cofins" type="number" placeholder="Ex: 7.6"
        style="width:100%; padding:10px; margin-top:5px; border:1px solid #777474; border-radius:6px;">
    </div>

    <button onclick="calcular()"
      style="margin-top:20px; background:#28a745; color:white; padding:10px 15px; border:none; border-radius:6px; cursor:pointer; width:100%; font-weight:bold;">
      Calcular
    </button>

    <pre id="resultado"
      style="background:#e9ecef; border-radius:6px; padding:10px; margin-top:20px; color:#333; font-size:14px; white-space: pre-wrap;">
O resultado aparecerá aqui...
</pre>

  </div>

  <script>
    function atualizarLabel() {
      const tipo = document.querySelector('input[name="tipo"]:checked').value;
      const label = document.getElementById("labelValor");

      if (tipo === "imposto") {
        label.innerText = "Valor Final do Produto:";
        document.getElementById("campoLucro").style.display = "none";
      } else {
        label.innerText = "Custo Total:";
        document.getElementById("campoLucro").style.display = "block";
      }
    }

    function mostrarCampos() {
      const regime = document.querySelector('input[name="regime"]:checked').value;

      document.getElementById("camposSimples").style.display = regime === "simples" ? "block" : "none";
      document.getElementById("camposDetalhados").style.display = regime === "simples" ? "none" : "block";
    }

    async function calcular() {
      const tipo = document.querySelector('input[name="tipo"]:checked').value;
      const regime = document.querySelector('input[name="regime"]:checked').value;
      const valor = parseFloat(document.getElementById("valor").value) || 0;
      const simples = parseFloat(document.getElementById("percSimples").value) || 0;
      const icms = parseFloat(document.getElementById("icms").value) || 0;
      const pis = parseFloat(document.getElementById("pis").value) || 0;
      const cofins = parseFloat(document.getElementById("cofins").value) || 0;
      const lucro = parseFloat(document.getElementById("lucro").value) || 0;

      const payload = {
        tipo,
        regime,
        valor,
        icms,
        pis,
        cofins,
        simples,
        lucro
      };

      try {
        const response = await fetch("https://kaiunq6fljuycsi4azptwlwqta0jddoo.lambda-url.us-east-1.on.aws/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        const data = await response.json();
        console.log(data);
        document.getElementById("resultado").innerText = data.response;

      } catch (err) {
        console.error("Erro:", err);
      }
    }
  </script>

</body>

</html>